{% extends 'amplio/base.html' %}
{% load static from staticfiles %}

{% block title_block %}Your opinion matters{% endblock %}

{% block main_block %}
    <h1>Profile</h1>
    <h2>Welcome, {{ user.name }}</h2>
    <div class="ui stackable grid">
        <div class="four wide column">
            <div class="ui fluid special card">
                <div class="blurring dimmable image" id="card-profile-container">
                    <div class="ui dimmer">
                        <div class="content">
                            <div class="center">
                                {% if user.image %}
                                    <div class="ui inverted animated button"
                                         onclick="removeImage('{% url 'amplio:remove_image' %}','{% url 'amplio:profile' %}')">
                                        <div class="visible content">
                                            &nbsp;&nbsp;&nbsp;<span class="fa fa-trash"></span>&nbsp;&nbsp;&nbsp;
                                        </div>
                                        <div class="hidden content">Remove</div>
                                    </div>
                                {% else %}
                                    <p id="profile-disclaimer">
                                        This is an identicon, a unique image generated by hashing your name and email. Upload an image to replace this one.
                                    </p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% if user.image %}
                        <img class="ui fluid image" src="{{ user.image.url }}" id="card-profile-image">
                    {% else %}
                        <svg class="ui fluid image"
                             data-jdenticon-hash="{{ request.session.user_name_email_hash }}"
                             viewBox="0 0 100 100">
                        </svg>
                    {% endif %}
                </div>
                <div class="content">
                    <div class="header">{{ user.name }}</div>
                    <div class="meta">{{ user.email }}</div>
                    <div class="description">{{ user.get_post_display }} at IIT Roorkee</div>
                </div>
            </div>
        </div>
        <div class="twelve wide column">
            <div class="ui top attached tabular menu" id="tabs">
                <a class="item active" data-tab="edit">Edit</a>
                <a class="item" data-tab="feedback">Feedback</a>
                <a class="item" data-tab="comments">Comments</a>
                <a class="item" data-tab="account">Account</a>
            </div>
            <div class="ui bottom attached tab segment active" data-tab="edit">
                <form action="{% url 'amplio:profile' %}" method="post"
                      class="ui form {% if state == 'success' %}success{% endif %}" enctype="multipart/form-data"
                      name="edit-profile">
                    {% csrf_token %}
                    <div class="field {% if form.name.errors %}error{% endif %}">
                        {{ form.name.label_tag }}
                        <div class="ui inverted fluid popup">
                            <p>What do people call you?</p>
                        </div>
                        <div class="ui left icon input">
                            {{ form.name }}
                            <i class="icon fa-user"></i>
                        </div>
                    </div>
                    <div class="field {% if form.image.errors %}error{% endif %}">
                        {{ form.image.label_tag }}
                        <div class="ui inverted fluid popup">
                            <p>To keep the previous image, leave this field blank</p>
                        </div>
                        <div class="ui left icon input">
                            {{ form.image }}
                            <i class="icon fa-file-picture-o"></i>
                        </div>
                    </div>
                    <button type="submit" class="ui primary button">
                        <span class="fa fa-user"></span>&nbsp;&nbsp;&nbsp;Update
                    </button>
                    <div class="ui error message" id="error-message">
                        <ul class="list">
                            {% if form.name.errors %}
                                <li>{{ form.name.errors|striptags }}</li>
                            {% endif %}
                            {% if form.image.errors %}
                                <li>{{ form.image.errors|striptags }}</li>
                            {% endif %}
                        </ul>
                    </div>
                    <div class="ui success message" id="success-message">
                        <div class="header">Great success!</div>
                        <p>
                            Your details have been updated.
                        </p>
                    </div>
                </form>
            </div>
            <div class="ui bottom attached tab segment" data-tab="feedback">
            </div>
            <div class="ui bottom attached tab segment" data-tab="comments">
            </div>
            <div class="ui bottom attached tab segment" data-tab="account">
            </div>
        </div>
    </div>
    <script>
        setUpAjax();
        $('#tabs').find('.item').tab();
        $('.special.card .image').dimmer({on: 'hover'});
        initializePopups('label');
    </script>
{% endblock %}